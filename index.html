<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flat Earth Model v5 - Layer 0: Surface</title>
    <style>/* ... –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ ... */</style>
</head>
<body>
    <div class="container">
        <canvas id="canvas"></canvas>
        <div class="panel">
            <!-- ... –æ—Å—Ç–∞–ª—å–Ω–æ–π UI ... -->
            <div class="section">
              <div class="section-title">üåë –ê—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è</div>
              <div id="eventList"></div>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script type="module">
        import SurfaceLayer from './layers/layer0-surface.js';
        let scene, camera, renderer, controls, surfaceLayer, isAnimating = false;
        let timeState = { year: 2025, month: 11, day: 24, hour: 9, minute: 21, second: 0 };
        async function loadEvents() {
            const resp = await fetch('./assets/events/eclipse_events.json');
            const events = await resp.json();
            const eventList = document.getElementById('eventList');
            eventList.innerHTML = events.map(ev => `
              <div>
                <b>${ev.event === 'solar_eclipse' ? '–°–æ–ª–Ω–µ—á–Ω–æ–µ –∑–∞—Ç–º–µ–Ω–∏–µ' : '–õ—É–Ω–Ω–æ–µ –∑–∞—Ç–º–µ–Ω–∏–µ'}</b> ‚Äî ${ev.date.slice(0,10)}<br>
                ${ev.description}<br>
                <button onclick="window.setEventTime('${ev.date}',${ev.longitude},${ev.latitude})">–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –º–æ–¥–µ–ª–∏</button>
              </div>
            `).join('<hr>');
        }
        function calculateCelestialPositions(time) {
            const earthRadius = 20000;
            const dayOfYear = Math.floor((new Date(time.year, time.month - 1, time.day) - new Date(time.year, 0, 1)) / 86400000) + 1;
            const hourAngle = (time.hour + time.minute / 60) / 24 * 2 * Math.PI;
            const sunDistance = earthRadius * 0.4;
            const sunX = sunDistance * Math.cos(hourAngle);
            const sunY = sunDistance * Math.sin(hourAngle);
            const moonPhaseShift = dayOfYear * 0.0335;
            const moonAngle = hourAngle + moonPhaseShift;
            const moonDistance = earthRadius * 0.3;
            const moonX = moonDistance * Math.cos(moonAngle);
            const moonY = moonDistance * Math.sin(moonAngle);
            return { sun: { x: sunX, y: sunY }, moon: { x: moonX, y: moonY } };
        }
        window.setEventTime = (date, lon, lat) => {
            const d = new Date(date);
            timeState.year = d.getUTCFullYear();
            timeState.month = d.getUTCMonth() + 1;
            timeState.day = d.getUTCDate();
            timeState.hour = d.getUTCHours();
            timeState.minute = d.getUTCMinutes();
            updateModel();
            // –í –±—É–¥—É—â–µ–º –¥–æ–±–∞–≤–∏—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫–µ –¥–ª—è —Å–æ–±—ã—Ç–∏–π!
        };
        function initScene() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000510);
            scene.fog = new THREE.Fog(0x000510, 100000, 300000);
            camera = new THREE.PerspectiveCamera(60, (window.innerWidth - 400) / window.innerHeight, 1000, 500000);
            camera.position.set(0, 50000, 50000);
            camera.lookAt(0, 0, 0);
            const canvas = document.getElementById('canvas');
            renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
            renderer.setSize(window.innerWidth - 400, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 15000;
            controls.maxDistance = 150000;
            scene.add(new THREE.AmbientLight(0x404060, 0.2));
            surfaceLayer = new SurfaceLayer(scene, { earthRadius: 20000 });
            updateModel();
            loadEvents();
            animate();
        }
        function updateModel() {
            if(surfaceLayer){
                const positions = calculateCelestialPositions(timeState);
                surfaceLayer.updateLighting(positions.sun, positions.moon);
            }
        }
        window.addEventListener('resize', () => {/*...*/});
        window.addEventListener('DOMContentLoaded', initScene);
    </script>
</body>
</html>