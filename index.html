<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flat Earth Model v6 - –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ –ø–ª–æ—Å–∫–æ—Å—Ç–∏</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background: #000;
        }
        .container { display: flex; height: 100vh; }
        #canvas { flex: 1; display: block; }
        .panel {
            width: 380px;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            padding: 15px;
            overflow-y: auto;
            box-shadow: -5px 0 15px rgba(0,0,0,0.3);
        }
        .panel h1 {
            font-size: 20px;
            margin-bottom: 15px;
            color: #4ecdc4;
            text-align: center;
        }
        .section {
            margin-bottom: 15px;
            background: rgba(255,255,255,0.05);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(78, 205, 196, 0.2);
        }
        .section-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #4ecdc4;
        }
        .control-group { margin-bottom: 10px; }
        .control-group label {
            display: block;
            margin-bottom: 4px;
            font-size: 12px;
            color: #b0b0b0;
        }
        .control-group input, .control-group select {
            width: 100%;
            padding: 6px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(78, 205, 196, 0.3);
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 13px;
        }
        .time-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .btn {
            width: 100%;
            padding: 8px;
            background: linear-gradient(135deg, #4ecdc4 0%, #3aa99f 100%);
            border: none;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 13px;
            margin-top: 8px;
        }
        .btn:hover { box-shadow: 0 3px 10px rgba(78, 205, 196, 0.4); }
        .btn-secondary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px; }
        .speed-control { display: flex; align-items: center; gap: 8px; margin-top: 8px; }
        .speed-control input[type="range"] { flex: 1; }
        .speed-label { min-width: 50px; text-align: center; font-weight: bold; color: #4ecdc4; font-size: 12px; }
        #currentTime {
            text-align: center;
            padding: 8px;
            background: rgba(78, 205, 196, 0.1);
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 16px;
            font-weight: bold;
            color: #4ecdc4;
        }
        #celestialInfo {
            font-size: 11px;
            color: #888;
            margin-top: 8px;
            padding: 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
            line-height: 1.5;
        }
        #eventList { max-height: 200px; overflow-y: auto; }
        #eventList > div {
            background: rgba(0,0,0,0.2);
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 8px;
            font-size: 12px;
        }
        #eventList button {
            margin-top: 6px;
            padding: 4px 8px;
            background: #ff6b6b;
            border: none;
            border-radius: 3px;
            color: white;
            cursor: pointer;
            font-size: 11px;
        }
        hr { border: none; height: 1px; background: rgba(78, 205, 196, 0.2); margin: 8px 0; }
    </style>
</head>
<body>
    <div class="container">
        <canvas id="mapCanvas"></canvas>
        <div class="panel">
            <h1>üåç Flat Earth Model v6</h1>
            
            <div class="section">
                <div class="section-title">‚è∞ –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è</div>
                <div id="currentTime">--:--:--</div>
                <div id="celestialInfo">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
                
                <div class="btn-group">
                    <button class="btn" id="playBtn" onclick="togglePlay()">‚ñ∂ –ü—É—Å–∫</button>
                    <button class="btn btn-secondary" onclick="resetTime()">üîÑ –°–±—Ä–æ—Å</button>
                </div>
                
                <div class="speed-control">
                    <label style="min-width: 70px; color: #b0b0b0; font-size: 12px;">–°–∫–æ—Ä–æ—Å—Ç—å:</label>
                    <input type="range" id="speedSlider" min="1" max="10000" value="60" step="1">
                    <span class="speed-label" id="speedLabel">60x</span>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">üìÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä–µ–º—è</div>
                <div class="control-group">
                    <label>–ì–æ–¥</label>
                    <input type="number" id="year" value="2025" min="1900" max="2100">
                </div>
                <div class="time-controls">
                    <div class="control-group">
                        <label>–ú–µ—Å—è—Ü</label>
                        <input type="number" id="month" value="11" min="1" max="12">
                    </div>
                    <div class="control-group">
                        <label>–î–µ–Ω—å</label>
                        <input type="number" id="day" value="25" min="1" max="31">
                    </div>
                </div>
                <div class="time-controls">
                    <div class="control-group">
                        <label>–ß–∞—Å</label>
                        <input type="number" id="hour" value="12" min="0" max="23">
                    </div>
                    <div class="control-group">
                        <label>–ú–∏–Ω—É—Ç—ã</label>
                        <input type="number" id="minute" value="0" min="0" max="59">
                    </div>
                </div>
                <button class="btn" onclick="updateTimeFromInputs()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            </div>

            <div class="section">
                <div class="section-title">üåë –°–æ–±—ã—Ç–∏—è –∑–∞—Ç–º–µ–Ω–∏–π</div>
                <div id="eventList">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>
    </div>

    <script>
        // ========== –ü–ê–†–ê–ú–ï–¢–†–´ ==========
        const EARTH_RADIUS = 20000;  // –º
        const SUN_HEIGHT = 5000;     // –º (–≤—ã—Å–æ—Ç–∞ –Ω–∞–¥ –ø–ª–æ—Å–∫–æ—Å—Ç—å—é)
        const MOON_HEIGHT = 4000;    // –º
        const SUN_ORBIT_MIN = EARTH_RADIUS * 0.25;
        const SUN_ORBIT_MAX = EARTH_RADIUS * 0.45;
        const MOON_ORBIT = EARTH_RADIUS * 0.35;
        
        // ========== –°–û–°–¢–û–Ø–ù–ò–ï ==========
        let canvas = document.getElementById('mapCanvas');
        let ctx = canvas.getContext('2d');
        let timeState = { year: 2025, month: 11, day: 25, hour: 12, minute: 0, second: 0 };
        let isPlaying = false;
        let timeSpeed = 60;
        let lastFrameTime = Date.now();
        
        function resizeCanvas() {
            canvas.width = window.innerWidth - 380;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // ========== –ê–°–¢–†–û–ù–û–ú–ò–ß–ï–°–ö–ò–ï –†–ê–°–ß–Å–¢–´ ==========
        
        function getDayOfYear(year, month, day) {
            const date = new Date(year, month - 1, day);
            const start = new Date(year, 0, 1);
            return Math.floor((date - start) / 86400000) + 1;
        }

        function isLeapYear(year) {
            return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
        }

        function getSolarDeclination(dayOfYear, year) {
            const daysInYear = isLeapYear(year) ? 366 : 365;
            const maxDeclination = 23.44 * Math.PI / 180;
            const summerSolstice = 172;
            const angle = 2 * Math.PI * (dayOfYear - summerSolstice) / daysInYear;
            return maxDeclination * Math.cos(angle);
        }

        function getSunOrbitRadius(declination) {
            const normalizedDeclination = declination / (23.44 * Math.PI / 180);
            const midRadius = (SUN_ORBIT_MIN + SUN_ORBIT_MAX) / 2;
            const radiusRange = (SUN_ORBIT_MAX - SUN_ORBIT_MIN) / 2;
            return midRadius - normalizedDeclination * radiusRange;
        }

        function getMoonPhase(year, month, day) {
            const synodicMonth = 29.53;
            const knownNewMoon = new Date(2000, 0, 6);
            const currentDate = new Date(year, month - 1, day);
            const daysSinceNewMoon = (currentDate - knownNewMoon) / 86400000;
            const phase = (daysSinceNewMoon % synodicMonth) / synodicMonth;
            return phase < 0 ? phase + 1 : phase;
        }

        function getMoonIntensity(phase) {
            // –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –ª—É–Ω–Ω–æ–≥–æ —Å–≤–µ—Ç–∞ (–ª—é–∫—Å—ã)
            const I_max = 0.25;
            const intensity = I_max * Math.pow(Math.sin(Math.PI * phase), 2);
            return intensity;
        }

        function calculateCelestialPositions(time) {
            const dayOfYear = getDayOfYear(time.year, time.month, time.day);
            const declination = getSolarDeclination(dayOfYear, time.year);
            const sunOrbitRadius = getSunOrbitRadius(declination);
            
            const hourFraction = (time.hour + time.minute / 60 + time.second / 3600) / 24;
            const hourAngle = -hourFraction * 2 * Math.PI;
            
            const sunX = sunOrbitRadius * Math.cos(hourAngle);
            const sunZ = sunOrbitRadius * Math.sin(hourAngle);
            const sunY = SUN_HEIGHT;
            
            // –õ–£–ù–ê: —Ñ–∞–∑–Ω—ã–π —Å–¥–≤–∏–≥ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –°–æ–ª–Ω—Ü–∞
            const moonPhase = getMoonPhase(time.year, time.month, time.day);
            const moonPhaseAngle = moonPhase * 2 * Math.PI;
            const moonAngle = hourAngle + moonPhaseAngle;
            const moonX = MOON_ORBIT * Math.cos(moonAngle);
            const moonZ = MOON_ORBIT * Math.sin(moonAngle);
            const moonY = MOON_HEIGHT;
            
            return {
                sun: { x: sunX, y: sunY, z: sunZ, orbitRadius: sunOrbitRadius },
                moon: { 
                    x: moonX, 
                    y: moonY, 
                    z: moonZ, 
                    phase: moonPhase,
                    intensity: getMoonIntensity(moonPhase)
                },
                dayOfYear: dayOfYear
            };
        }

        function getMoonPhaseName(phase) {
            if (phase < 0.03 || phase > 0.97) return '–ù–æ–≤–æ–ª—É–Ω–∏–µ';
            if (phase < 0.22) return '–ú–æ–ª–æ–¥–∞—è –ª—É–Ω–∞';
            if (phase < 0.28) return '–ü–µ—Ä–≤–∞—è —á–µ—Ç–≤–µ—Ä—Ç—å';
            if (phase < 0.47) return '–ü—Ä–∏–±—ã–≤–∞—é—â–∞—è';
            if (phase < 0.53) return '–ü–æ–ª–Ω–æ–ª—É–Ω–∏–µ';
            if (phase < 0.72) return '–£–±—ã–≤–∞—é—â–∞—è';
            if (phase < 0.78) return '–ü–æ—Å–ª–µ–¥–Ω—è—è —á–µ—Ç–≤–µ—Ä—Ç—å';
            return '–°—Ç–∞—Ä–∞—è –ª—É–Ω–∞';
        }

        // ========== –†–ê–°–ß–Å–¢ –û–°–í–ï–©–Å–ù–ù–û–°–¢–ò –ö–ê–ñ–î–û–ô –¢–û–ß–ö–ò –ü–õ–û–°–ö–û–°–¢–ò ==========
        
        function calculateIllumination(x, z, sunPos, moonPos) {
            // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ç–æ—á–∫–∏ –¥–æ –ø—Ä–æ–µ–∫—Ü–∏–∏ —Å–≤–µ—Ç–∏–ª–∞ –Ω–∞ –ø–ª–æ—Å–∫–æ—Å—Ç—å
            const sunDist = Math.sqrt((x - sunPos.x) ** 2 + (z - sunPos.z) ** 2);
            const moonDist = Math.sqrt((x - moonPos.x) ** 2 + (z - moonPos.z) ** 2);
            
            // –£–≥–æ–ª –ø–∞–¥–µ–Ω–∏—è —Å–æ–ª–Ω–µ—á–Ω–æ–≥–æ —Å–≤–µ—Ç–∞ (–∫–æ—Å–∏–Ω—É—Å —É–≥–ª–∞)
            const sunDistance = Math.sqrt(sunDist ** 2 + sunPos.y ** 2);
            const sunCosAngle = Math.max(0, sunPos.y / sunDistance);
            
            // –£–≥–æ–ª –ø–∞–¥–µ–Ω–∏—è –ª—É–Ω–Ω–æ–≥–æ —Å–≤–µ—Ç–∞
            const moonDistance = Math.sqrt(moonDist ** 2 + moonPos.y ** 2);
            const moonCosAngle = Math.max(0, moonPos.y / moonDistance);
            
            // –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å —Å–≤–µ—Ç–∞ —É–±—ã–≤–∞–µ—Ç —Å –∫–≤–∞–¥—Ä–∞—Ç–æ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
            const sunIntensity = 100000 * sunCosAngle / (sunDistance ** 2 / 1e8);  // –ª—é–∫—Å—ã (–¥–µ–Ω—å)
            const moonIntensity = moonPos.intensity * moonCosAngle / (moonDistance ** 2 / 1e8);  // –ª—é–∫—Å—ã (–Ω–æ—á—å)
            
            // –û–±—â–∞—è –æ—Å–≤–µ—â—ë–Ω–Ω–æ—Å—Ç—å
            const totalLux = Math.max(sunIntensity, moonIntensity);
            
            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º: –¥–µ–Ω—å ~100000 –ª—é–∫—Å = 255, –Ω–æ—á—å ~0.25 –ª—é–∫—Å = 1
            const normalized = Math.log10(totalLux + 1) / 5;  // –ª–æ–≥–∞—Ä–∏—Ñ–º–∏—á–µ—Å–∫–∞—è —à–∫–∞–ª–∞
            const brightness = Math.min(255, Math.max(0, normalized * 255));
            
            return brightness;
        }

        // ========== –†–ò–°–û–í–ê–ù–ò–ï –ö–ê–†–¢–´ ==========
        
        function drawMap(positions) {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = 3;  // –ø–∏–∫—Å–µ–ª–∏ –Ω–∞ –º–µ—Ç—Ä
            
            // –ü—Ä–æ–µ–∫—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
            const projectX = (x) => centerX + x * scale;
            const projectY = (z) => centerY + z * scale;
            
            // –†–∞–∑–º–µ—Ä –æ–±–ª–∞—Å—Ç–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
            const maxDist = Math.max(EARTH_RADIUS, SUN_ORBIT_MAX) * 1.5;
            
            // –°–æ–∑–¥–∞—ë–º image data
            const imageData = ctx.createImageData(canvas.width, canvas.height);
            const data = imageData.data;
            
            for (let py = 0; py < canvas.height; py++) {
                for (let px = 0; px < canvas.width; px++) {
                    const x = (px - centerX) / scale;
                    const z = (py - centerY) / scale;
                    
                    const brightness = calculateIllumination(x, z, positions.sun, positions.moon);
                    
                    // –ó–∞–ª–∏–≤–∞–µ–º –ø–∏–∫—Å–µ–ª—å: R=G=B=brightness (—Å–µ—Ä–∞—è —à–∫–∞–ª–∞)
                    const idx = (py * canvas.width + px) * 4;
                    data[idx] = brightness;      // R
                    data[idx + 1] = brightness;  // G
                    data[idx + 2] = brightness;  // B
                    data[idx + 3] = 255;         // A
                }
            }
            
            ctx.putImageData(imageData, 0, 0);
            
            // –†–∏—Å—É–µ–º –≥—Ä–∞–Ω–∏—Ü—É –∑–µ–º–ª–∏-–ø–ª–æ—Å–∫–æ—Å—Ç–∏
            ctx.strokeStyle = '#444444';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(centerX, centerY, EARTH_RADIUS * scale, 0, Math.PI * 2);
            ctx.stroke();
            
            // –†–∏—Å—É–µ–º –æ—Ä–±–∏—Ç—É –°–æ–ª–Ω—Ü–∞
            ctx.strokeStyle = 'rgba(255, 200, 0, 0.3)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.arc(centerX, centerY, positions.sun.orbitRadius * scale, 0, Math.PI * 2);
            ctx.stroke();
            
            // –†–∏—Å—É–µ–º –æ—Ä–±–∏—Ç—É –õ—É–Ω—ã
            ctx.strokeStyle = 'rgba(150, 150, 255, 0.2)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.arc(centerX, centerY, MOON_ORBIT * scale, 0, Math.PI * 2);
            ctx.stroke();
        }

        // ========== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê ==========
        
        function updateTimeDisplay() {
            const h = String(timeState.hour).padStart(2, '0');
            const m = String(timeState.minute).padStart(2, '0');
            const s = String(Math.floor(timeState.second)).padStart(2, '0');
            document.getElementById('currentTime').textContent = 
                `${timeState.year}-${String(timeState.month).padStart(2, '0')}-${String(timeState.day).padStart(2, '0')} ${h}:${m}:${s}`;
        }

        function updateCelestialInfo(positions) {
            const info = document.getElementById('celestialInfo');
            info.innerHTML = `
                <b>‚òÄÔ∏è –°–æ–ª–Ω—Ü–µ:</b> –æ—Ä–±–∏—Ç–∞ ${Math.round(positions.sun.orbitRadius)}–º<br>
                <b>üåô –õ—É–Ω–∞:</b> ${getMoonPhaseName(positions.moon.phase)} (${Math.round(positions.moon.phase * 100)}%)<br>
                <b>üí° –õ—É–Ω–Ω—ã–π —Å–≤–µ—Ç:</b> ${positions.moon.intensity.toFixed(4)} –ª—é–∫—Å<br>
                <b>üìç –î–µ–Ω—å –≥–æ–¥–∞:</b> ${positions.dayOfYear}
            `;
        }

        // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–†–ï–ú–ï–ù–ï–ú ==========
        
        window.updateTimeFromInputs = () => {
            timeState.year = parseInt(document.getElementById('year').value);
            timeState.month = parseInt(document.getElementById('month').value);
            timeState.day = parseInt(document.getElementById('day').value);
            timeState.hour = parseInt(document.getElementById('hour').value);
            timeState.minute = parseInt(document.getElementById('minute').value);
            timeState.second = 0;
        };

        window.togglePlay = () => {
            isPlaying = !isPlaying;
            document.getElementById('playBtn').textContent = isPlaying ? '‚è∏ –ü–∞—É–∑–∞' : '‚ñ∂ –ü—É—Å–∫';
        };

        window.resetTime = () => {
            const now = new Date();
            timeState = {
                year: now.getFullYear(),
                month: now.getMonth() + 1,
                day: now.getDate(),
                hour: now.getHours(),
                minute: now.getMinutes(),
                second: now.getSeconds()
            };
            document.getElementById('year').value = timeState.year;
            document.getElementById('month').value = timeState.month;
            document.getElementById('day').value = timeState.day;
            document.getElementById('hour').value = timeState.hour;
            document.getElementById('minute').value = timeState.minute;
        };

        // ========== –ê–ù–ò–ú–ê–¶–ò–Ø ==========
        
        function advanceTime(deltaSeconds) {
            timeState.second += deltaSeconds;
            
            while (timeState.second >= 60) { timeState.second -= 60; timeState.minute++; }
            while (timeState.minute >= 60) { timeState.minute -= 60; timeState.hour++; }
            while (timeState.hour >= 24) {
                timeState.hour -= 24;
                timeState.day++;
                const daysInMonth = new Date(timeState.year, timeState.month, 0).getDate();
                if (timeState.day > daysInMonth) {
                    timeState.day = 1;
                    timeState.month++;
                    if (timeState.month > 12) { timeState.month = 1; timeState.year++; }
                }
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            
            if (isPlaying) {
                const now = Date.now();
                const deltaTime = (now - lastFrameTime) / 1000;
                lastFrameTime = now;
                advanceTime(deltaTime * timeSpeed);
            } else {
                lastFrameTime = Date.now();
            }
            
            const positions = calculateCelestialPositions(timeState);
            drawMap(positions);
            updateTimeDisplay();
            updateCelestialInfo(positions);
        }

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        
        document.getElementById('speedSlider').addEventListener('input', (e) => {
            timeSpeed = parseInt(e.target.value);
            document.getElementById('speedLabel').textContent = timeSpeed + 'x';
        });

        window.resetTime();
        animate();
    </script>
</body>
</html>
