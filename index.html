<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flat Earth Model v5 - Layer 0: Surface</title>
    <style>/* ... стили без изменений ... */</style>
</head>
<body>
    <div class="container">
        <canvas id="canvas"></canvas>
        <div class="panel"> <!-- ... интерфейс панели без изменений ... --> </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script>
        let scene, camera, renderer, controls, surfaceLayer, isAnimating = false;
        let timeState = { year: 2025, month: 11, day: 24, hour: 9, minute: 21, second: 0 };
        class SurfaceLayer {
            constructor(scene, config) {
                this.scene = scene;
                this.config = config;
                this.createSurface();
            }
            createSurface() {
                const earthRadius = this.config.earthRadius || 20000;
                const geometry = new THREE.PlaneGeometry(earthRadius * 2, earthRadius * 2, 100, 100);
                // Загружаем текстуру карты
                const loader = new THREE.TextureLoader();
                loader.load('assets/textures/azimuthal_map.png', texture => {
                    texture.wrapS = THREE.ClampToEdgeWrapping;
                    texture.wrapT = THREE.ClampToEdgeWrapping;
                    texture.minFilter = THREE.LinearFilter;
                    const material = new THREE.MeshBasicMaterial({ map: texture, side: THREE.DoubleSide });
                    this.mesh = new THREE.Mesh(geometry, material);
                    this.mesh.rotation.x = -Math.PI / 2;
                    this.scene.add(this.mesh);
                });
            }
            // Режим освещения (дальше будет shader, сейчас базовая текстура)
            updateLighting() {
                // Если потребуется — добавить слои-подсветки поверх
            }
        }
        // Остальная логика не меняется (панель управления, updateModel и т.д.)
        function calculateCelestialPositions(time) {/* ...без изменений... */}
        function initScene() {/* ...инициализация сцены без изменений, только SurfaceLayer ... */
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000510);
            scene.fog = new THREE.Fog(0x000510, 100000, 300000);
            camera = new THREE.PerspectiveCamera(60, (window.innerWidth - 400) / window.innerHeight, 1000, 500000);
            camera.position.set(0, 50000, 50000);
            camera.lookAt(0, 0, 0);
            const canvas = document.getElementById('canvas');
            renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
            renderer.setSize(window.innerWidth - 400, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 15000;
            controls.maxDistance = 150000;
            scene.add(new THREE.AmbientLight(0x404060, 0.2));
            surfaceLayer = new SurfaceLayer(scene, { earthRadius: parseFloat(document.getElementById('earthRadius').value) });
            updateModel();
            animate();
        }
        function updateModel() { /* ...как раньше, surfaceLayer.updateLighting() ... */ }
        // все остальные функции (updateTime, updateLighting и пр.) без изменений
        window.addEventListener('resize', () => {
            camera.aspect = (window.innerWidth - 400) / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth - 400, window.innerHeight);
        });
        window.addEventListener('DOMContentLoaded', initScene);
    </script>
</body>
</html>